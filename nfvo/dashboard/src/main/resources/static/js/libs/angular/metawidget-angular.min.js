// Metawidget 3.7 minified
//
// This library is dual licensed under both LGPL and a commercial
// license. See http://metawidget.org for details 
//
// Author: Richard Kennard (http://kennardconsulting.com)

(function(){var b=["$compile","$parse",function(d,e){return{restrict:"E",scope:{ngModel:"=",readOnly:"=",config:"=",configs:"&"},transclude:true,compile:function f(i,h,g){return function(m,l,k){var o=new metawidget.angular.AngularMetawidget(l,k,g,m,d,e);var n=undefined;j();m.$watch("ngModel",function(q,p){if(q!==n&&typeof(q)==="object"){o.invalidateInspection();j()}});m.$watch("readOnly",function(q,p){if(q!==o.readOnly){j()}});m.$watch("config",function(q,p){if(q!==p){o.configure(q);j()}});function j(){n=m.$eval("ngModel");o.path=k.ngModel;o.toInspect=m.$parent.$eval(metawidget.util.splitPath(o.path).type);o.readOnly=m.$eval("readOnly");o.buildWidgets()}}}}}];var a=angular.module("metawidget",[]);a.directive("metawidget",b);a.directive("mwMetawidget",b);metawidget.angular=metawidget.angular||{};var c=0;metawidget.angular.AngularMetawidget=function(h,e,d,i,g,j){if(!(this instanceof metawidget.angular.AngularMetawidget)){throw new Error("Constructor called as a function")}var f=new metawidget.Pipeline(h[0]);f._superLayoutWidget=f.layoutWidget;f.layoutWidget=function(o,l,n,m,p){f._superLayoutWidget.call(this,o,l,n,m,p);if(o.overridden===undefined){g(o)(i.$parent)}};var k=undefined;this.invalidateInspection=function(){k=undefined};f.inspector=new metawidget.inspector.PropertyTypeInspector();f.inspectionResultProcessors=[new metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor(i)];f.widgetBuilder=new metawidget.widgetbuilder.CompositeWidgetBuilder([new metawidget.widgetbuilder.OverriddenWidgetBuilder(),new metawidget.widgetbuilder.ReadOnlyWidgetBuilder(),new metawidget.widgetbuilder.HtmlWidgetBuilder()]);f.widgetProcessors=[new metawidget.widgetprocessor.IdProcessor(),new metawidget.widgetprocessor.PlaceholderAttributeProcessor(),new metawidget.widgetprocessor.DisabledAttributeProcessor(),new metawidget.angular.widgetprocessor.AngularWidgetProcessor(j,i)];f.layout=new metawidget.layout.HeadingTagLayoutDecorator(new metawidget.layout.TableLayout());
this.configure=function(l){f.configure(l);this.invalidateInspection()};this.configure(i.$eval("config"));this.configure(i.configs());this.inspect=function(n,l,m){return f.inspect(n,l,m,this)};this.buildWidgets=function(p){var l=d(i.$parent,function(q){return q});this.overriddenNodes=[];for(var m=0;m<l.length;m++){var o=l[m];if(o.nodeType===1&&(o.tagName!=="SPAN"||o.attributes.length>1)){this.overriddenNodes.push(o)}}if(p!==undefined){k=p}else{if(k===undefined){if(arguments.length>0){throw new Error("Calling buildWidgets( undefined ) may cause infinite loop. Check your argument, or pass no arguments instead")}var n=metawidget.util.splitPath(this.path);k=f.inspect(this.toInspect,n.type,n.names,this)}}f.buildWidgets(k,this)};this.onEndBuild=function(){while(this.overriddenNodes.length>0){var m=this.overriddenNodes[0];this.overriddenNodes.splice(0,1);if(m.tagName==="FACET"){continue}var p=undefined;for(var r=0,n=m.attributes.length;r<n;r++){var o=m.attributes[r];var q=e.$normalize(o.name).toLowerCase();if(q==="ngbind"||q==="ngmodel"){var s=metawidget.util.splitPath(o.value);var t=i.$parent.$eval(s.type);p=f.inspect(t,s.type,s.names,this);break}}if(p===undefined){p={section:""}}if(m.tagName==="STUB"){for(var r=0,n=m.attributes.length;r<n;r++){var l=m.attributes[r];p[l.nodeName]=l.nodeValue}}f.layoutWidget(m,"property",p,f.element,this)}};this.getElement=function(){return f.element};this.buildNestedMetawidget=function(l,m){var o=metawidget.util.createElement(this,"metawidget");o.setAttribute("ng-model",e.ngModel+"."+l.name);if(metawidget.util.isTrueOrTrueString(l.readOnly)){o.setAttribute("read-only","true")}else{if(e.readOnly!==undefined){o.setAttribute("read-only",e.readOnly)}}var p="_metawidgetConfig"+c++;i.$parent[p]=f;if(m!==undefined){var n="_metawidgetConfig"+c++;i.$parent[n]=m;o.setAttribute("configs","["+p+","+n+"]")}else{o.setAttribute("config",p)}return o}};metawidget.angular.inspectionresultprocessor=metawidget.angular.inspectionresultprocessor||{};metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor=function(d){if(!(this instanceof metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor)){throw new Error("Constructor called as a function")
}this.processInspectionResult=function(f,i){i._angularInspectionResultProcessor=i._angularInspectionResultProcessor||[];for(var e in f){var h=f[e];if(h instanceof Object){this.processInspectionResult(h,i);continue}if(h===undefined||h===null||h.slice===undefined){continue}if(h.length<4||h.slice(0,2)!=="{{"||h.slice(h.length-2,h.length)!=="}}"){continue}h=h.slice(2,h.length-2);f[e]=d.$parent.$eval(h)+"";var g=d.$parent.$watch(h,function(m,k){if(m!==k){for(var j=0,l=i._angularInspectionResultProcessor.length;j<l;j++){i._angularInspectionResultProcessor[j]()}i.invalidateInspection();i.buildWidgets()}});i._angularInspectionResultProcessor.push(g)}return f}};metawidget.angular.widgetprocessor=metawidget.angular.widgetprocessor||{};metawidget.angular.widgetprocessor.AngularWidgetProcessor=function(f,e){if(!(this instanceof metawidget.angular.widgetprocessor.AngularWidgetProcessor)){throw new Error("Constructor called as a function")}this.processWidget=function(k,p,j,o){var m=o.path;if(p!=="entity"){m+="."+j.name}if(k.tagName==="OUTPUT"){if(j.masked===true){e.$parent.mwMaskedOutput=d;k.setAttribute("ng-bind","mwMaskedOutput("+m+")")}else{if(j.type==="array"){k.setAttribute("ng-bind",m+".join(', ')")}else{if(j.enumTitles!==undefined){e.$parent.mwLookupEnumTitle=e.$parent.mwLookupEnumTitle||{};e.$parent.mwLookupEnumTitle[m]=function(q){return metawidget.util.lookupEnumTitle(q,j["enum"],j.enumTitles)};k.setAttribute("ng-bind",'mwLookupEnumTitle["'+m+'"]('+m+")")}else{k.setAttribute("ng-bind",m)}}}}else{if(k.tagName==="INPUT"&&(k.getAttribute("type")==="button"||k.getAttribute("type")==="submit")){k.setAttribute("ng-click",m+"()")}else{if(j["enum"]!==undefined&&(j.type==="array"||j.componentType!==undefined)&&k.tagName==="DIV"){for(var l=0,i=k.childNodes.length;l<i;l++){var n=k.childNodes[l];if(n.tagName==="LABEL"&&n.childNodes.length===2){var h=n.childNodes[0];if(h.tagName==="INPUT"){if(h.getAttribute("type")==="radio"){h.setAttribute("ng-model",m)}else{if(h.getAttribute("type")==="checkbox"){h.setAttribute("ng-checked",m+".indexOf('"+h.value+"')>=0");
e.$parent.mwUpdateSelection=g;h.setAttribute("ng-click","mwUpdateSelection($event,'"+m+"')")}}}}}}else{k.setAttribute("ng-model",m)}}}if(j.required!==undefined){k.setAttribute("ng-required",j.required)}if(j.minLength!==undefined){k.setAttribute("ng-minlength",j.minLength)}if(j.maxLength!==undefined){k.setAttribute("ng-maxlength",j.maxLength);k.removeAttribute("maxlength")}return k};function g(h,l){var j=e.$parent.$eval(l);if(j===undefined){j=[];f(l).assign(e.$parent,j)}var k=h.target;var i=j.indexOf(k.value);if(k.checked===true){if(i===-1){j.push(k.value)}return}if(i!==-1){j.splice(i,1)}}function d(h){if(h===undefined){return}return metawidget.util.fillString("*",h.length)}}})();
